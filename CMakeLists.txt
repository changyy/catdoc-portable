cmake_minimum_required(VERSION 2.8)
project (catdoc)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)

set(TOOL_MS_OFFICE_EXTRACTOR_DIR catdoc-0.94.2)
	file(COPY ${CMAKE_SOURCE_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR} DESTINATION ${CMAKE_BINARY_DIR})
	add_custom_command(
		OUTPUT BUILD_CATDOC
		COMMAND ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/configure --build=x86_64-linux-gnu --host=${target_platform} --prefix=${CMAKE_INSTALL_PREFIX} 1>/dev/null && make 1>/dev/null && mkdir -p ${CMAKE_RUNTIME_OUTPUT_DIRECTORY} && cp ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/src/catdoc ${CMAKE_RUNTIME_OUTPUT_DIRECTORY} && cp ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/src/catppt ${CMAKE_RUNTIME_OUTPUT_DIRECTORY} && cp ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/src/xls2csv ${CMAKE_RUNTIME_OUTPUT_DIRECTORY} && cp ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/charsets/ascii.spc ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/charsets/ascii.specchars && cp ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/charsets/ascii.rpl ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/charsets/ascii.replchars && cp -r ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}/charsets ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/../opt-arm_opt-share-catdoc
		WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}
		COMMENT "Build catdoc"
	)
	add_custom_command(
		OUTPUT CLEAN_CATDOC
		COMMAND make clean
		WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/${TOOL_MS_OFFICE_EXTRACTOR_DIR}
		COMMENT "Clean catdoc"
	)
	add_custom_target(build_catdoc ALL DEPENDS BUILD_CATDOC )
	add_custom_target(clean_catdoc CLEAN DEPENDS CLEAN_CATDOC )
